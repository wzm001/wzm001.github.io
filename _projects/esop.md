---
layout: page
title: esop
description: 员工股权管理系统
img: assets/img/esop.png
importance: 1
category: 工作
---

[ESOP](https://www.uponeshare.com/) (Employee Stock Ownership Plan) 指员工持股计划，公司借由让员工认购公司的股票，成为公司的股东之一。员工因此被激励会更努力工作，为公司和自己同时创造财富，实现双赢。老虎证券的 ESOP 系统是一款面向企业及员工的 SaaS 服务平台，负责管理企业发放给员工的期权/股票/现金 (统称为激励工具) 的完整生命周期，具体包括激励工具的授予、成熟、 归属、交易等环节。系统为 B 端用户提供了专业的企业审计报表工具和完善的授予发放管理功能，为 C 端用户提供了一站式的交易平台，归属的股票可以直接通过老虎 APP 进行交易。项目采用微服务架构开发部署，整体的架构如下图所示：

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.html path="assets/img/esop-arch.png" title="push node" class="img-fluid rounded z-depth-1"  zoomable=true %}
    </div>
</div>
<div class="caption">
    ESOP 的服务架构
</div>

各个微服务之间通过共享数据存储和 RPC 框架通信。

ESOP 的微服务有两套环境，分别在北京和香港部署。这是国家对券商行业的限制，上市公司的信息只能存放到上市地所在的服务器。两套环境之间的数据彼此隔离，只有发生公司上市退市等操作时才会涉及到数据迁移操作。前端通过登录服务返回的标识确定接下来该用户需要访问哪一套环境，整个过程对用户是无感知的。

ESOP 系统各个服务的作用：

## ESOP 的业务服务

### ESOP-Login

登录 + 集群路由服务。主要作用是统一认证，生成用户的操作 token，参考了 JWT 的设计理念。

### ESOP-Admin

企业数据管理服务。主要处理 ESOP 面向 B 端的授予业务。具体负责管理企业员工数据、授予的生成、发放、成熟、取消、归属等业务逻辑。以及企业侧的相关业务配置。

服务内按照公司做多租户设计，各个公司之间彼此数据隔离，每个公司只能查看到自己的数据，多租户设计的底层是由 `Mybatis-Plus` [实现](https://baomidou.com/pages/aef2f2/) 的。

### ESOP-Staff

员工服务。主要处理员工端的授予行权、资产查看、协议签署等业务逻辑。

### ESOP-Bos

ESOP 后台数据管理服务。主要是 ESOP 内部运营人员使用，负责管理整个系统的数据。

### ESOP-Report

系统报表服务。主要提供 B 端各种业务和财务报表。因为报表业务比较重，所以单独抽取出一个服务。

### ESOP-OpenAPI

系统的开放接口服务。负责给第三方企业的 OA 系统提供接入的 API，使用请求签名保证接口安全。

## ESOP 的基础服务

### ESOP-Batch

负责执行系统的定时任务。ESOP 系统中有很多业务和时间挂钩，比如授予成熟、离职、报表等，需要通过定时任务处理数据。

### [ESOP-Push](https://wzm001.github.io/projects/esop-push/)

消息推送服务。负责处理各个渠道的消息推送，例如邮件、短信等，封装业务模版，尽量做到和业务系统解耦。

### [ESOP-Sign](https://wzm001.github.io/projects/esop-sign/)

在线签署服务。负责处理业务流程中的合同签署场景。整个 ESOP 业务中涉及到很多需要签署协议的场景。

### [ESOP-KMS](https://wzm001.github.io/projects/esop-kms/)

数据加解密服务。负责整个系统的数据加解密以及密钥管理。

### ESOP-Grant

授予快照服务。使用 Canal 监听业务数据库，对授予表和关联数据进行快照处理。主要作用是支持事件回溯、报表生成等业务。

## 底层数据服务

### ESOP-FileServer

文件存储服务。统一管理 ESOP 系统中所有的文件，主要包括协议和模版文件、报表文件等。底层依赖 Amazon S3 服务。

### Redis & MySQL

数据缓存和持久化存储。

## 依赖的外部服务

### 上上签

提供签署证书服务。

### 邮件/短信推送服务

提供邮件/短信消息渠道支持。

### 老虎 APP

提供员工行权的交易接口。

# ESOP 业务梳理

ESOP 的核心业务概念是 *授予（Grant）*。授予当作动词理解，即公司授予员工某些权益和激励的动作。授予作为名词理解，代表员工被赋予的权益，公司通过授予激励员工做出更大的贡献。

授予有多种形式的载体，常见的有：
- 期权 Option，一般是上市前公司进行授予，许诺员工在将来获取一定的公司权益；
- 限制性股票 RS，上市后公司进行授予，通常会在交易和行权上进行一定的限制，具体还可以细分为第一类限制性股票和第二类限制性股票，在处理上有一些区别；
- 现金，也有公司以现金的方式授予员工激励；

授予通常承诺的是未来的收益，因此伴随授予的必不可少的业务就是成熟规则，用来规定授予分几个批次成熟，每次成熟间隔时间是多久，成熟比例是多少等等。一般情况下，成熟的授予即可以通过行权转换为一定的收益。

TODO
