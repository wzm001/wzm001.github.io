---
layout: distill
title:  快照隔离
date:   2023-03-06 10:45:16 +8:00
description: 快照隔离于可串行化
tags: 数据库 事务 快照隔离
categories: Databases
giscus_comments: true
---

# 什么是快照隔离

快照隔离（Snapshot isolation），指的是每次事务启动时，数据库就为这个事务提供一个当前数据库的一致性快照（数据库中所有已提交的记录），后续其他事务对数据的增删改操作，这个事务都看不到，它始终看到的是自己的一致性快照。

## 实现

快照隔离需要使用长写锁来防止脏写。（参阅[[2023-03-03-database-transactions]]）。因此意味着进行写入的事务会阻止其他事务修改相同的对象。但读取则不需要加锁，从性能的角度来看，快照隔离的关键原则是：**读不阻塞写，写不阻塞读**。

为了实现快照隔离，数据库需要保留一个对象的多个不同提交版本，因为各种正在进行的事务可能需要看到数据库在不同时间点的状态。因为数据库同时维护耽搁对象的多个版本，所以这种技术被称为**多版本并发控制（MVCC, Multi-version concurrency control）**。

{% include figure.html path="assets/img/fig7-7.png" class="img-fluid rounded z-depth-1" zoomable=true %}

上图说明了 PostgreSQL 如何实现 MVCC 的快照隔离（其他实现类似）。当一个事务开始时，它被赋予一个唯一的，永远增长的事务ID（`txid`）。每当事务向数据库写入任何内容时，它所写入的数据都会被标记上写入者的事务ID。
